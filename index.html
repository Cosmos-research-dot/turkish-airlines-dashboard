<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turkish Airlines Dashboard - Live Edition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            margin-bottom: 35px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid #c41e3a;
        }
        .logo-section { display: flex; gap: 20px; align-items: center; }
        .logo-icon { font-size: 48px; }
        .logo-text { font-size: 20px; font-weight: 800; color: #c41e3a; text-transform: uppercase; letter-spacing: 1px; }
        .logo-subtitle { font-size: 10px; color: #999; margin-top: 5px; }
        .status-badge { display: inline-flex; align-items: center; gap: 6px; background: #c41e3a; color: white; padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: 700; margin-bottom: 8px; }
        .status-dot { width: 8px; height: 8px; background: #27ae60; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
        .card { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 25px; border-top: 4px solid #c41e3a; }
        .card h2 { font-size: 22px; margin-bottom: 25px; color: #1a472a; font-weight: 800; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 15px; margin-bottom: 20px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; font-size: 12px; color: #555; text-transform: uppercase; }
        input, select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px; font-family: inherit; }
        input:focus, select:focus { outline: none; border-color: #c41e3a; box-shadow: 0 0 8px rgba(196, 30, 58, 0.2); background: #fff9f9; }
        button { padding: 14px 28px; background: #c41e3a; color: white; border: none; border-radius: 6px; font-weight: 700; cursor: pointer; font-size: 14px; text-transform: uppercase; width: 100%; margin-top: 20px; transition: all 0.3s; }
        button:hover { background: #a01830; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(196, 30, 58, 0.3); }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .flight-card { background: #f8f9fa; border: 2px solid #e0e0e0; padding: 16px; margin: 12px 0; border-radius: 8px; display: grid; grid-template-columns: 90px 1fr 130px; gap: 20px; align-items: center; cursor: pointer; transition: all 0.3s; }
        .flight-card:hover { border-color: #c41e3a; box-shadow: 0 4px 15px rgba(196, 30, 58, 0.2); }
        .flight-time { font-size: 26px; font-weight: 800; color: #c41e3a; text-align: center; }
        .flight-code { font-weight: 800; color: #1a472a; font-size: 14px; }
        .flight-info { font-size: 12px; color: #666; }
        .flight-price { font-size: 28px; font-weight: 800; color: #27ae60; text-align: right; }
        .result-item { background: linear-gradient(135deg, #f8f9fa 0%, #f0f1f3 100%); padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 5px solid #c41e3a; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .info-box { background: #e8f5e9; border-left: 4px solid #27ae60; padding: 15px; margin: 15px 0; border-radius: 6px; font-size: 13px; color: #2d5a3d; }
        .error-box { background: #ffebee; border-left: 4px solid #c41e3a; padding: 15px; margin: 15px 0; border-radius: 6px; font-size: 13px; color: #c41e3a; }
        .loading { display: inline-block; width: 14px; height: 14px; border: 2px solid #c41e3a; border-top: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        footer { text-align: center; padding: 30px; color: rgba(255,255,255,0.7); font-size: 12px; }
        .api-status { font-size: 11px; color: #666; margin-top: 10px; padding: 8px; background: #f5f5f5; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-section">
                <div class="logo-icon">üõ´</div>
                <div>
                    <div class="logo-text">Turkish Airlines</div>
                    <div class="logo-subtitle">Live MCP Dashboard</div>
                </div>
            </div>
            <div class="header-right">
                <div class="status-badge"><span class="status-dot"></span> <span id="api-status">CONNECTING...</span></div>
                <div style="font-size: 12px; color: #666;">MCP Integration<br><span id="time"></span></div>
            </div>
        </header>

        <div class="card">
            <h2>‚úàÔ∏è Search Flights</h2>
            <div class="grid">
                <div><label>From (IATA)</label><input type="text" id="origin" placeholder="IST" maxlength="3" value="IST"></div>
                <div><label>To (IATA)</label><input type="text" id="destination" placeholder="LHR" maxlength="3" value="LHR"></div>
                <div><label>Departure Date</label><input type="date" id="departDate"></div>
            </div>
            <button onclick="searchFlights()" id="searchBtn">üîç Search Flights</button>
            <div id="flightResults"></div>
            <div class="info-box">üí° Connected to Turkish Airlines MCP Server for real-time data</div>
            <div class="api-status">API: <span id="api-flight-status">Ready</span></div>
        </div>

        <div class="card">
            <h2>üìä Flight Status</h2>
            <div class="grid">
                <div><label>Flight Number</label><input type="text" id="flightNum" placeholder="TK123"></div>
                <div><label>Date</label><input type="date" id="statusDate"></div>
            </div>
            <button onclick="getFlightStatus()" id="statusBtn">üìç Check Status</button>
            <div id="statusResults"></div>
            <div class="api-status">API: <span id="api-status-status">Ready</span></div>
        </div>

        <div class="card">
            <h2>üìã Booking Details</h2>
            <div class="grid">
                <div><label>PNR Reference</label><input type="text" id="pnr" placeholder="ABC123" maxlength="6"></div>
                <div><label>Last Name</label><input type="text" id="surname" placeholder="Your Last Name"></div>
            </div>
            <button onclick="getBooking()" id="bookingBtn">üé´ Get Booking</button>
            <div id="bookingResults"></div>
            <div class="api-status">API: <span id="api-booking-status">Ready</span></div>
        </div>

        <div class="card">
            <h2>üéâ Promotions & Offers</h2>
            <div class="grid">
                <div><label>Country</label><input type="text" id="promoCountry" placeholder="TR" maxlength="2" value="TR"></div>
            </div>
            <button onclick="getPromotions()" id="promoBtn">üéÅ View Promotions</button>
            <div id="promoResults"></div>
            <div class="api-status">API: <span id="api-promo-status">Ready</span></div>
        </div>

        <div class="card">
            <h2>üåç City Guides</h2>
            <div class="grid">
                <div><label>Destination City</label><input type="text" id="city" placeholder="London, Paris, Istanbul..." value="London"></div>
            </div>
            <button onclick="getCityGuide()" id="guideBtn">Get Guide</button>
            <div id="guideResults"></div>
            <div class="api-status">API: <span id="api-guide-status">Ready</span></div>
        </div>

        <div class="card">
            <h2>üìö Features & Status</h2>
            <ul style="list-style: none; margin: 15px 0;">
                <li style="padding: 10px 0; border-bottom: 1px solid #eee;"><strong>‚úàÔ∏è Flight Search</strong> - Real-time availability</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #eee;"><strong>üìç Flight Status</strong> - Live tracking</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #eee;"><strong>üé´ Booking Management</strong> - View reservations</li>
                <li style="padding: 10px 0; border-bottom: 1px solid #eee;"><strong>üéÅ Promotions</strong> - Current offers</li>
                <li style="padding: 10px 0;"><strong>üåç City Guides</strong> - Travel info</li>
            </ul>
            <div class="info-box">üîó <strong>MCP Integration:</strong> Connected to https://mcp.turkishtechlab.com/</div>
        </div>
    </div>

    <footer>Turkish Airlines Dashboard ¬© 2026 | Live MCP Integration | All Rights Reserved</footer>

    <script>
        const API_BASE = '';  // Local API
        
        document.getElementById('departDate').valueAsDate = new Date();
        document.getElementById('statusDate').valueAsDate = new Date();

        // Update time
        setInterval(() => {
            document.getElementById('time').innerHTML = new Date().toLocaleTimeString();
        }, 1000);

        // Check API Health
        async function checkAPIHealth() {
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                if (response.ok) {
                    document.getElementById('api-status').innerHTML = '‚úÖ LIVE';
                    document.querySelector('.status-dot').style.background = '#27ae60';
                } else {
                    throw new Error('API unavailable');
                }
            } catch (error) {
                document.getElementById('api-status').innerHTML = '‚ö†Ô∏è MOCK MODE';
                document.querySelector('.status-dot').style.background = '#ff9800';
            }
        }

        checkAPIHealth();
        setInterval(checkAPIHealth, 10000);  // Check every 10 seconds

        function updateAPIStatus(field, status) {
            document.getElementById(`api-${field}-status`).innerHTML = status;
        }

        function displayResults(id, title, data) {
            document.getElementById(id).innerHTML = `
                <div class="result-item">
                    <h3 style="color: #1a472a; font-weight: 800; margin-bottom: 12px;">${title}</h3>
                    <pre style="background: white; padding: 12px; border-radius: 6px; font-size: 12px; color: #666; overflow-x: auto;">${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }

        function displayError(id, error) {
            document.getElementById(id).innerHTML = `<div class="error-box">‚ö†Ô∏è Error: ${error}</div>`;
        }

        async function searchFlights() {
            const origin = document.getElementById('origin').value.toUpperCase();
            const dest = document.getElementById('destination').value.toUpperCase();
            const date = document.getElementById('departDate').value;

            if (!origin || !dest || !date) {
                alert('Please fill all fields');
                return;
            }

            document.getElementById('searchBtn').disabled = true;
            document.getElementById('searchBtn').innerHTML = '<span class="loading"></span> Searching...';
            updateAPIStatus('flight', 'Loading...');

            try {
                const response = await fetch(`${API_BASE}/api/search-flights`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ origin, destination: dest, date, passengers: 1 })
                });

                if (!response.ok) throw new Error('API request failed');
                const data = await response.json();

                if (data.success) {
                    let html = `<div style="margin-top: 20px;"><h3 style="color: #1a472a; margin-bottom: 15px; font-weight: 800;">Flights on ${date}</h3>`;
                    data.flights.forEach(f => {
                        html += `<div class="flight-card">
                            <div class="flight-time">${f.departure}</div>
                            <div>
                                <div class="flight-code">${f.number}</div>
                                <div class="flight-info">${origin} ‚Üí ${dest} | ${f.duration}</div>
                            </div>
                            <div class="flight-price">$${f.price}</div>
                        </div>`;
                    });
                    html += '</div>';
                    document.getElementById('flightResults').innerHTML = html;
                    updateAPIStatus('flight', '‚úÖ Success');
                } else {
                    displayError('flightResults', data.error || 'Unknown error');
                    updateAPIStatus('flight', '‚ùå Failed');
                }
            } catch (error) {
                displayError('flightResults', error.message);
                updateAPIStatus('flight', '‚ùå Failed');
            } finally {
                document.getElementById('searchBtn').disabled = false;
                document.getElementById('searchBtn').innerHTML = 'üîç Search Flights';
            }
        }

        async function getFlightStatus() {
            const flightNumber = document.getElementById('flightNum').value.toUpperCase();
            const date = document.getElementById('statusDate').value;

            if (!flightNumber || !date) {
                alert('Please fill all fields');
                return;
            }

            document.getElementById('statusBtn').disabled = true;
            updateAPIStatus('status', 'Loading...');

            try {
                const response = await fetch(`${API_BASE}/api/flight-status`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ flightNumber, date })
                });

                const data = await response.json();
                if (data.success) {
                    displayResults('statusResults', 'üìç Flight Status', data);
                    updateAPIStatus('status', '‚úÖ Success');
                } else {
                    displayError('statusResults', data.error || 'Unknown error');
                    updateAPIStatus('status', '‚ùå Failed');
                }
            } catch (error) {
                displayError('statusResults', error.message);
                updateAPIStatus('status', '‚ùå Failed');
            } finally {
                document.getElementById('statusBtn').disabled = false;
            }
        }

        async function getBooking() {
            const pnr = document.getElementById('pnr').value.toUpperCase();
            const surname = document.getElementById('surname').value;

            if (!pnr || !surname) {
                alert('Please fill all fields');
                return;
            }

            document.getElementById('bookingBtn').disabled = true;
            updateAPIStatus('booking', 'Loading...');

            try {
                const response = await fetch(`${API_BASE}/api/booking-details`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pnr, surname })
                });

                const data = await response.json();
                if (data.success) {
                    displayResults('bookingResults', 'üìã Booking Details', data);
                    updateAPIStatus('booking', '‚úÖ Success');
                } else {
                    displayError('bookingResults', data.error || 'Unknown error');
                    updateAPIStatus('booking', '‚ùå Failed');
                }
            } catch (error) {
                displayError('bookingResults', error.message);
                updateAPIStatus('booking', '‚ùå Failed');
            } finally {
                document.getElementById('bookingBtn').disabled = false;
            }
        }

        async function getPromotions() {
            const country = document.getElementById('promoCountry').value.toUpperCase();

            document.getElementById('promoBtn').disabled = true;
            updateAPIStatus('promo', 'Loading...');

            try {
                const response = await fetch(`${API_BASE}/api/promotions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ country })
                });

                const data = await response.json();
                if (data.success) {
                    displayResults('promoResults', 'üéâ Promotions', data);
                    updateAPIStatus('promo', '‚úÖ Success');
                } else {
                    displayError('promoResults', data.error || 'Unknown error');
                    updateAPIStatus('promo', '‚ùå Failed');
                }
            } catch (error) {
                displayError('promoResults', error.message);
                updateAPIStatus('promo', '‚ùå Failed');
            } finally {
                document.getElementById('promoBtn').disabled = false;
            }
        }

        async function getCityGuide() {
            const city = document.getElementById('city').value;

            if (!city) {
                alert('Please enter a city name');
                return;
            }

            document.getElementById('guideBtn').disabled = true;
            updateAPIStatus('guide', 'Loading...');

            try {
                const response = await fetch(`${API_BASE}/api/city-guide`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ city })
                });

                const data = await response.json();
                if (data.success) {
                    displayResults('guideResults', `üåç ${city} Guide`, data);
                    updateAPIStatus('guide', '‚úÖ Success');
                } else {
                    displayError('guideResults', data.error || 'Unknown error');
                    updateAPIStatus('guide', '‚ùå Failed');
                }
            } catch (error) {
                displayError('guideResults', error.message);
                updateAPIStatus('guide', '‚ùå Failed');
            } finally {
                document.getElementById('guideBtn').disabled = false;
            }
        }
    </script>
</body>
</html>